<html>
<head>
<script>
	function process(data = '') {
		data = data
					 .split('\n')
					 .map(line => line.split(' -> ')
					 .map(sets => sets.split(',')
					 .map(points => +points)));
		return data;
	}
	
	function setCanvas(data = []) {
		let width = 0, height = 0;
		let canvas = [];
		
		data.forEach( 
			lines => lines.forEach(
				sets => {
					let [x, y] = sets;
					width < x ? width = x : width;
					height < y ? height = y : height;
				}
			)
		);

		for(let y = 0; y <= height; y++) {
			canvas.push([]);
			for(let x = 0; x <= width; x++) {
				canvas[y].push(0);
			}
		}
		return canvas;
	}
	
	function fillCanvas(data = [], diagram = []) {
		data.forEach((lines) => {
			let [x1, y1] = lines[0], 
					[x2, y2] = lines[1];
			
			function getInit (steps = 0) {
				return 0;
			}
			
			function getCon (i = 0, steps = 0) {
				if (steps < 0)
					return i >= steps;
				return i <= steps;
			}
			
			function getFinal (i = 0, steps = 0) {
				if (steps < 0)
					return -1;
				return 1;
			}

			if (y1 == y2) {
				
				let steps = x2 - x1;	
				for (let i = getInit(steps); getCon(i, steps); i += getFinal(i, steps)) {
					diagram[y1][x1 + i]++;
				}
				
			} else if (x1 == x2) {
				
				let steps = y2 - y1;
				for (let i = getInit(steps); getCon(i, steps); i += getFinal(i, steps)) {
					diagram[y1 + i][x1]++;
				}
				
			} else if (x1 > x2 && !(y1 > y2)) {
				
				let steps = y2 - y1;
				for (let i = getInit(steps); getCon(i, steps); i += getFinal(i, steps)) {
					diagram[y1 + i][x1 - i]++;
				} 
				
			} else if (!(x1 > x2) && y1 > y2) {
				
				let steps = x2 - x1;
				for (let i = getInit(steps); getCon(i, steps); i += getFinal(i, steps)) {
					diagram[y1 - i][x1 + i]++;
					
				}
			} else {
				
				let steps = y2 - y1;
				for (let i = getInit(steps); getCon(i, steps); i += getFinal(i, steps)) {
					diagram[y1 + i][x1 + i]++;
					
				}
			}
		});
		
		return diagram;
	}
	
	function drawDiagram(data = []) {
		let diagram = [];
		diagram = setCanvas(data);
		diagram = fillCanvas(data, diagram);
		return diagram;
	}
	
	function getValueSum(diagram = [], min = 0) {
		let total = 0;
		for(let rows of diagram) {
			for(let items of rows) {
				items >= min ? total++ : total;
			}
		}
		console.log(diagram);
		return total;
	}
	
	//FUN VISUAL STUFF
	
	function stringifyDiagram (diagram = []) {
		let diagramStr = '';
		diagram.forEach(
			row => { 
				row.forEach( item => {
				item == 0 ?
					diagramStr += item
					:
					diagramStr += `<span class = "positive">${item}</span>`;
				});
				diagramStr += '<br>';
			});
		return diagramStr;
	}
	
	function printToPage (diagram = '') {
		let p = document.createElement('p');
		p.innerHTML = diagram;
		document.querySelector('.page').append(p);
	}
	
	async function finishLoading () {
		function timeout(time = 0) {
			return new Promise(resolve => {
				setTimeout(() => {
					resolve('resolved');
				}, time);
			});
		}
		await timeout(7000);
		document.querySelector('.loader').style.display = 'none';
		document.querySelector('.page').style.display = 'block';
	}
	
	window.onload = () => {
		fetch('data.txt')
		.then(response => response.text())
		.then(rawData => process(rawData))
		.then(data => drawDiagram(data))
		.then(diagram => stringifyDiagram(diagram))
		.then(strDiag => printToPage(strDiag))
		.then(() => finishLoading());	
	}
</script>
<style>
	body { 
		min-height: 95%; 
		background: #0e1824;
	}
	p { font-family: monospace; color: #bababa; }
	.page { display: none; }
	.positive { background: #e85151; color: black; }
	
	.loader {
		display: flex;
		min-height: 100%;
		justify-content: center;
		align-items: center;
	}
	.load-icon { 
		margin: 0%; 
		width: 300px;
		height: 300px;
		
		animation-duration: 3s;
		animation-name: rotate;
		animation-iteration-count: infinite;
	}

@keyframes rotate {
  from {
		transform: rotate(360deg);
  }

  to {
    transform: rotate(0deg);
  }
}
</style>
</head>
<body>	
	<div class='page'>
	</div>
	<div class='loader'>
		<img class='load-icon' src='loading.png'>
	</div>
</body>
</html>